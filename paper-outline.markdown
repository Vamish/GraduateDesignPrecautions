# 信息分析与预测系统前端数据对接、框架与用户交互设计

## 引言
数据分析的目的是把隐没在一大批看来杂乱无章的数据中的信息集中、萃取和提炼出来，以找出所研究对象的内在规律。在实用中，数据分析可帮助人们作出判断，以便采取适当行动。数据分析是组织有目的地收集数据、分析数据，使之成为信息的过程。

信息采集、浏览、查询、交换、分析与预测，是信息社会重要的特征。国内外已经有许多著名的统计分析软件，例如SPSS, Statistica，SAS等，但是这类桌面端的软件在安装时需要费较长的时间和经过一系列相对复杂的操作学习，大大提高了用户使用的门槛，减低了进行数据分析的效率。而运行在浏览器的网页版软件，可以通过网址直接进行访问、使用，省去用户安装的时间，可以把大部分的精力都放在需要注意的事情上。而且相对于桌面端对于系统硬件的要求，网页端的计算全部在云端服务器上进行，用户只需关心数据的内容，而非是数据之外的麻烦。

前端框架的发展，已经允许我们在浏览器上实现相对复杂的软件操作，而且网页端的图表更新迭代的速度远大于桌面端的传统软件，这允许我们在本设计中运用交互性、便捷性、可读性更好的图表展示。这可使用户可以更清楚的了解，更透彻的分析，更直观的发现数据的关联、趋势等之前在传统桌面软件中不曾或难以发现的内容。

## 一、相关技术综述
### 1.1 Bootstrap 前端框架介绍
2011年8月，Twitter Bootstrap 诞生。到如今Bootstrap 已成为前端设计领域最受欢迎的辅助技术。Bootstrap是一组用于网站和网络应用程序开发的开源前端（所谓“前端”，指的是展现给最终用户的界面。与之对应的“后端”是在服务器上面运行的代码）框架，包括HTML、CSS及JavaScript的框架，提供字体排印、窗体、按钮、导航及其他各种组件及Javascript扩展，旨在使动态网页和Web应用的开发更加容易。Bootstrap 提供了大量可重用的组件，可以让开发者快速搭建优秀的、易于维护的网站。
### 1.2 HTML5 存储特性介绍
HTML5 是HTML 最新的修订版本，2014年10月由万维网联盟（W3C）完成标准制定。目标是替换1999年所制定的HTML 4.01和XHTML 1.0标准。HTML5 并不只是一个单独的技术。他是一个概括性的术语，包含了新的以及增强的HTML 元素、CSS样式、Javascript API 和事件。[参考文献](HTML5 开发手册 Chuck Hudson,Tom Leadbetter)

HTML5 在原先DOM 接口的基础上，增加了更多样化的API与提供了自定义数据属性。
    【TODO】图书馆

#### 1.2.1 本地存储API
本地存储API 是HTML5 API 中的一个新增项。传统网站在页面端的数据存储需求一般靠Cookie 操作，但Cookie 的存储大小十分有限，仅为4KB，常见的用途是在网站“记住密码”、存储用户身份判断数据等。并不适用于存储数据量复杂的情况。

HTML5 提供的本地存储API 中包括了：localStorage 和  sessionStorage 两种存储对象。其使用范围与生命周期各有不同。localStorage 与sessionStorage 的存储大小一般为5MB，仅在客户端保存，并不参与和服务器的通信。其中localStorage 除非用户清楚，否则将会永久保存，而sessionStorage 仅在当前会话下有效，用户关闭页面或浏览器后都将被清除。
    
[参考文献](http://jerryzou.com/posts/cookie-and-web-storage/)

#### 1.2.2 自定义data-* 属性
自定义data-* 属性是以"data-*"开头的属性，其没有独立的命名空间。该属性与XML 兼容。
自定义data-* 属性用于当没有合适的属性或元素时存储页面中或者应用程序的定义数据。
    【TODO】图书馆
[参考文献](https://www.w3.org/TR/2011/WD-html5-20110525/elements.html#embedding-custom-non-visible-data-with-the-data-attributes)
### 1.3 Ajax 介绍
AJAX即“Asynchronous JavaScript and XML”（异步的JavaScript与XML技术），指的是一套综合了多项技术的浏览器端网页开发技术。Ajax的概念由杰西·詹姆士·贾瑞特所提出。

传统的Web应用允许用户端填写表单（form），当提交表单时就向Web服务器发送一个请求。服务器接收并处理传来的表单，然后送回一个新的网页，但这个做法浪费了许多带宽，因为在前后两个页面中的大部分HTML码往往是相同的。由于每次应用的沟通都需要向服务器发送请求，应用的回应时间依赖于服务器的回应时间。这导致了用户界面的回应比本机应用慢得多。

与此不同，AJAX应用可以仅向服务器发送并取回必须的数据，并在客户端采用JavaScript处理来自服务器的回应。因为在服务器和浏览器之间交换的数据大量减少,服务器回应更快了。同时，很多的处理工作可以在发出请求的客户端机器上完成，因此Web服务器的负荷也减少了。

## 二、系统设计
### 2.1 系统托管与版本控制
本系统由项目小组成员在不同地点协同完成，各有分工，所以设计系统之前最先考虑的是项目的托管与版本控制问题。

在比较目前流行的VCS（版本控制系统）后发现，开源社区Github 不仅能提供稳定的托管服务还解决了版本控制的问题，而且自带的issue 功能还能起到分配任务与bug 反馈的功能。这大大降低了项目维护的成本并提高了项目的稳定性。

### 2.2 程序流程与用户交互设计
本系统的主要流程如下：

用户访问 -> 数据上传 -> 数据表格展示 -> 用户选择相对应的数据分析功能 -> 参数与配置选择并提交 -> 展示相对应的数据表格与图表 -> 流程结束

【TODO】这里应该有个图

在用户使用本系统的过程中我们发现，绝大部分用户上传的数据文件为xls/xlsx 格式，在上传文件只有单一sheet的情况下，系统会直接跳转到该数据的数据展示页面并展示该数据。但由于Microsoft Office 套件在新建Excel 文档时默认会有sheet1 - sheet3 三个表单，而用户在本系统中分析的数据一般只有一个表单，所以我们在用户上传文件的时候会优先让用户选择要分析的表单，再对这个表单进行操作。这样一来，不仅用户不会因为操作到无关的表单而产生无效、干扰的数据结果，系统在处理相对应的表单的时候也能能快速高效的获取用户所选择、输入的值。

并且在优化用户交互体验方面，为了防止用户在选择表单的时候由于失误选错了表单，本系统会提供了在数据展示页面动态切换表单的功能。

### 2.3 前端框架设计与数据对接模块设计
本系统功能繁多，而且各个功能之间的相关参数并没有复用的必要性。每个功能的传参都有独立的控件分别控制。因为每个功能间的参数、配置选择都是相互独立的。在本系统内应用的框架模式是在原有Bootstrap 样式框架的基础上，分功能设定出每个功能的弹框页面，并在该HTML 页面内应该有该功能逻辑的相关控制方法。并且由于功能点与可允许用户操作的菜单是一一对应的关系，通过这些功能所在的路径，定义好菜单的JSON 格式的配置文件，用户访问数据展示页面的页面上打印出可以让用户操作的菜单栏。

由于前后端的完全分离，在本系统中项目组决定使用JSON 作为数据传输的数据包。这是因为考虑到JSON 类型的通用性：无论是在前端Javascript 环境下或者是后端Java 环境下都有良好的支持。前端在数据对接模块采用了MVC 架构模式进行管理控制。在用户点击提交时，系统会设置一个改功能的标志位，每个功能控件中的参数封装成JSON 格式的数据包（Model 层）后封装好的方法VariableSubmit.js（Controller 层）通过Ajax 发送到指定标志位的后端进行处理，再后端处理后返回相对应的结果时，先判断返回数据的状态是否是正常可用的，若结果可用则把数据保存并跳转数据展示页面并且打印相对应的数据表格、数据图（View 层）等后续操作。

【TODO】这里能有一张图

### 2.4 多语言配置设计
多语言是本系统中一个可以独立的功能，它不参与具体的参数传输，只负责在页面内切换不同的语种时显示相对应的语种标签。于是这个功能应该完全由前端来负责实现。在设计时采用了MVC 架构模式来实现多语言配置模块。即通过定义一个JSON 格式的文件来存储所有有可切换语言的标签内的显示内容（Model 层），通过一个独立的控制类i18n.js 来负责页面间的具体的语种显示（Controller 层），通过定义可切换的标签中"data-i18n-type"与"data-i18n-tag"自定义属性来决定该标签显示的多语言类型与具体内容（View 层）。

【TODO】这边应该有个图

### 2.5 参数处理流程设计
与其他数据操作系统不同，本系统中的参数

### 2.6 数据展示模块设计
在数据展示模块同样使用了MVC 架构模式。通过用户在提交时设置的标志位，在控制器resultTableGenerator.js（Controller 层）中判断采取哪种变量表格生成的方法。并在方法中取出之前返回成功结果的JSON 数据（Model 层），并对此数据在数据展示页（View 层）进行打印。

【TODO】这边应该有个图

## 三、系统主要功能实现
在系统设计时决定的前后台分离使系统的逻辑框架更为清晰。笔者在项目中主要负责前端部分，下面将主要讲解前端部分的功能实现。

### 3.1 本地配置存储

### 3.2 数据文档上传
本系统现在支持四种数据文档格式的文件，分别是.xls，.xlsx，.dat，.txt。前端的主要职责是在用户选择文件后，并在上传之前判断该文件格式符不符合前文提到的四种文件格式，若不符合规范，应该在用户上传之前有相应的警告，并且提示用户上传正确格式的文件。

【TODO】一张用户上传文件失败的运行截图

若文件上传成功，后台会返回相应的JSON数据格式，如下图所示

【TODO】两张接口JSON 图，一张isMultiSheet=true,一张false

通过该JSON 的数据提示，若isMultiSheet=false，则直接跳到数据展示页面。若有多个表单的情况，则应该弹出选择框让用户选择要处理的表单

【TODO】一张截图

### 3.2 多语言切换
设计中提到的多语言配置的控制器i18n.js，其名称来源于internationalization（国际化），因首字母i与末字母n中间隔了18个字母，故缩写为i18n。

其逻辑如下：

【TODO】i18n逻辑代码

在用户第一次使用本系统的时候，因为没有相关的语言选项，默认为中文。用户可以在上传数据的页面右上角的『设置』中找到切换语言的菜单项。点击相对应的语言即可进行切换。
中遇到的需要切换多语言的情况

### 3.4 变量选择规则

### 3.4 数据展示

## 四、系统难点的解决与创新
### 4.1 本系统的创新点
#### 4.1.1 多语言配置模块
    【TODO】多语言是这个系统中一个。。。
#### 4.1.2 功能模块化
#### 4.1.3 变量选择规则模块
#### 4.1.4 HTML5 数据存储
##### 4.1.4.1 本地存储API
    【TODO】根据localStorage 与sessionStorage 的特性不同，我们可以知道，localStorage 使用与存储常用的、不会经常改变配置，如用户语种选择、结果小数保留位数。而考虑到用户可能多次使用本系统，所以sessionStorage 更适合存储一些不用长时间存储的值，比如文件的sheet编号、相应功能的配置信息等。
##### 4.1.3.2 自定义data-* 数据存储
### 4.2 本系统的特色
### 4.3 本系统的难点
    【TODO】本系统的难点在与功能多、数据量复杂，配置、数据处理的情况各不相同。

## 总结

## 致谢
    本文在选题、撰写过程和系统的设计上得到了丁跃潮教授的细心帮助与指导，特此感谢。

## 参考文献
